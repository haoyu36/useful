> 爬虫就是抓取网页数据的程序，一般用于爬取网页中链接，资源等，高级的网络爬虫为搜索引擎

> 爬虫最需要关注的不是页面信息，而是页面信息的**数据来源**


### 爬虫框架

#### requests

- 页面级爬虫
- 并发性考虑不足，性能较差
- 重点在于页面下载
- 定制灵活
- 上手十分简单

#### Scrapy

- 网站级爬虫
- 并发性好，性能较高
- 重点在于爬虫结构
- 一般定制灵活，深度定制困难
- 入门稍难


### 去重

- 将访问过的 `url` 保存到数据库
- 将问过的 `url` 保存到 `set` 中，`O(1)` 时间就可以查询到，但当 `url` 过多时占用太多内存空间
- `url` 经过 `md5` 等方法哈希后保存到 `set` 中
- 用 `bitmap` 方法，将访问过的 `url` 通过 hash 函数映射到每一位，但 `hash` 冲突较多
- `bloomfilter` 方法对 `bitmap` 进行改进，多重 `hash` 函数降低冲突


### 爬虫效率优化

- 并发：多线程、多进程、asyncio
- 使用布隆过滤器
- 批量存储到数据库
- 设置请求超时时间


### 常见的反爬虫和应对方法

- 服务器会拦截所有非浏览器的请求(使用随机 UA)
- 查看 refer 页做防盗链接(可以改 refer 项)
- 需要 Cookie 才能获取数据
- 基于用户行为的策略，同一 ip 会被限制(ip 池)
- 数据需要使用 js 生成(模拟异步 ajax 请求)
- 破解验证码
- selenium / webdriver 模拟浏览器加载


### cookie过期的处理问题

- 采用selenium自动登录获取cookie，保存到文件;
- 读取cookie，比较cookie的有效期，若过期则再次执行步骤
- 进而可以维护一个 Cookies 池


### 验证码

> 爬虫工程师的目的不是破解图片验证码，而是不会触发验证码

最简单的是几个数字组合的图形验证码，还有极验滑动验证码，点触验证码。对于图形验证码，可以使用 OCR 技术识别。先使用 PIL 库读取图片，然后用 tesserocr 识别。极验滑动验证码需要拖动拼合滑块才能完成验证



### 爬虫工作范围

- 熟悉网页抓取原理及技术
- 设计爬虫策略和防屏蔽规则
- 提升网页抓取的效率和质量
- 分布式抓取架构设计和维护
- 数据清洗/入库
- 大数据处理(Hadoop、Spark、Hive、HBase、Kafka)
- 抓取协议设计与开发
